# ğŸ‘Œå¦‚ä½•é¿å…æ¶ˆæ¯ä¸¢å¤±ï¼Ÿ

[æ­¤å¤„ä¸ºè¯­é›€å¡ç‰‡ï¼Œç‚¹å‡»é“¾æ¥æŸ¥çœ‹](https://www.yuque.com/jingdianjichi/xyxdsi/lskgbf55ax5xm7n8#Dx0k7)

# å£è¯­åŒ–å›ç­”
å¥½çš„ï¼Œé¢è¯•å®˜ï¼Œæ¶ˆæ¯ä¸¢å¤±æ˜¯ä¸€ä¸ªç»å¸¸ä¼šè®¨è®ºçš„é—®é¢˜ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªæˆ‘ä»¬éœ€è¦é‡ç‚¹å…³æ³¨çš„é—®é¢˜ã€‚æ¶ˆæ¯ä¸¢å¤±å…¶å®ä¸»è¦äº§ç”Ÿåœ¨å‡ ä¸ªç¯èŠ‚ï¼ŒæŒ‰ç…§æ¶ˆæ¯çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¯èƒ½ä¼šåœ¨ç”Ÿäº§ä¸­ä¸¢å¤±ï¼Œä¼ è¾“ä¸­ä¸¢å¤±ï¼Œå­˜å‚¨ä¸­ä¸¢å¤±ï¼Œæ¶ˆè´¹ä¸­ä¸¢å¤±ã€‚æ¥ä¸‹æ¥ä¸€ä¸ªä¸ªè¯´ä¸€ä¸‹ã€‚å½“ç”Ÿäº§ä¸­æ¶ˆæ¯äº§ç”Ÿä¸¢å¤±çš„æ—¶å€™ï¼Œæ¯”å¦‚å®é™…æ¶ˆæ¯æœªå‘å‡ºï¼Œä½†æ˜¯ç¨‹åºè®¤ä¸ºå‘å‡ºäº†ï¼Œè¿™ç§ä¸»è¦æ˜¯è¦ä¿è¯æˆ‘ä»¬å‘é€æ¶ˆæ¯çš„æ—¶å€™ä¸æŠ¥é”™ã€‚å¦‚æœå‘ç”Ÿé—®é¢˜ï¼Œç›´æ¥ catch æˆ–è€…å¼‚æ­¥æœªå¤„ç†ï¼Œå°±å¯èƒ½ä¼šä¸¢ã€‚è¿™é‡Œä¸ä¸¢ä¹‹åï¼Œæ¶ˆæ¯ä¼šä¼ è¾“åˆ° mqã€‚mq ä¼šé€šè¿‡ç¡®è®¤æœºåˆ¶å‘Šè¯‰ï¼Œmq æ”¶åˆ°äº†æ¶ˆæ¯ï¼Œè¿™å—å¯ä»¥é€šè¿‡ mq æœºåˆ¶æ¥ä¿éšœã€‚ç„¶åå°±æ˜¯æŒä¹…åŒ–ï¼Œæ¯ä¸ª mq éƒ½æœ‰è‡ªå·±çš„æŒä¹…åŒ–æœºåˆ¶ï¼Œæ¯”å¦‚ raid ç­–ç•¥æˆ–è€…é•œåƒå¤åˆ¶ç­‰ç­‰ã€‚æœ€åå°±æ˜¯æ¶ˆè´¹è€…çš„æ¶ˆè´¹ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯é€šè¿‡ ack æœºåˆ¶æ¥å®ç°çš„ï¼Œå½“æ¶ˆè´¹è€…æ­£å¸¸æ¶ˆè´¹æ¶ˆæ¯åï¼Œå‘Šè¯‰ mqï¼Œæˆ‘å®Œäº‹äº†ï¼Œä¹Ÿå°±æ˜¯ ackï¼Œmq æ‰ä¼šè®¤ä¸ºè¿™ä¸ªæ¶ˆæ¯è¢«æ­£å¸¸æ¶ˆè´¹äº†ã€‚

ä»¥ä¸Šã€‚

# é¢˜ç›®è§£æ
æ¶ˆæ¯ä¸¢å¤±ä¹Ÿæ˜¯å¾ˆå¸¸è§çš„ä¸€é“é¢˜ï¼Œè¿™é“é¢˜æ¯”è¾ƒå¥½è®°ï¼ŒæŒ‰ç…§æ¶ˆæ¯çš„ç”Ÿå‘½å‘¨æœŸï¼Œä»æ¶ˆæ¯ç”Ÿäº§ï¼Œåˆ°ä¼ è¾“ï¼Œåˆ°å­˜å‚¨ï¼Œåˆ°æ¶ˆè´¹ï¼Œå°±å¯ä»¥è¾¾çš„æ¯”è¾ƒæ˜ç™½ï¼Œé¡ºåºä¸è¦ä¹±ï¼Œå®¹æ˜“ä¸¢ã€‚

# é¢è¯•å¾—åˆ†ç‚¹
ç”Ÿäº§è¿‡ç¨‹ï¼Œä¼ è¾“è¿‡ç¨‹ï¼Œå­˜å‚¨è¿‡ç¨‹ï¼Œæ¶ˆè´¹è¿‡ç¨‹ï¼Œé‡è¯•ï¼Œackï¼ŒæŒä¹…åŒ–

# é¢˜ç›®è¯¦ç»†ç­”æ¡ˆ
è¦é¿å…æ¶ˆæ¯ä¸¢å¤±ï¼Œå¯ä»¥ä»ä»æ¶ˆæ¯çš„ç”Ÿäº§ã€ä¼ è¾“ã€å­˜å‚¨å’Œæ¶ˆè´¹å„ä¸ªç¯èŠ‚å…¥æ‰‹ã€‚

## æ¶ˆæ¯ä¸¢å¤±çš„åŸå› 
![ç”»æ¿](./img/D1HiTCGbbgmV-Mm-/1723734968610-a456ae38-854e-4937-bdbf-3bfe1377dcd7-979050.jpeg)

## è§£å†³æ–¹æ¡ˆ
### æ¶ˆæ¯ç”Ÿäº§è¿‡ç¨‹ä¸­çš„å¯é æ€§ä¿è¯
ç¡®ä¿æ¶ˆæ¯è¢«æˆåŠŸå‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿã€‚**æ¯”å¦‚ Kafka**ï¼šä½¿ç”¨acksé…ç½®ï¼Œè®¾ç½®ä¸ºallï¼Œç¡®ä¿æ¶ˆæ¯è¢«æ‰€æœ‰å‰¯æœ¬ç¡®è®¤ã€‚**RabbitMQ** åˆ™ä½¿ç”¨publisher confirmsï¼Œç¡®ä¿æ¶ˆæ¯è¢«é˜Ÿåˆ—æ¥æ”¶ã€‚

åœ¨Kafkaä¸­ï¼š

```plain
Properties props = new Properties();
props.put("bootstrap.servers", "localhost:9092");
props.put("acks", "all"); // ç¡®ä¿æ¶ˆæ¯è¢«æ‰€æœ‰å‰¯æœ¬ç¡®è®¤
props.put("key.serializer", "org.apache.kafka.common.serialization.StringSerializer");
props.put("value.serializer", "org.apache.kafka.common.serialization.StringSerializer");
Producer<String, String> producer = new KafkaProducer<>(props);

for (int i = 0; i < 10; i++) {
    producer.send(new ProducerRecord<>("my-topic", "key", "message-" + i), new Callback() {
        public void onCompletion(RecordMetadata metadata, Exception e) {
            if (e != null) {
                e.printStackTrace();
            } else {
                System.out.println("Message sent successfully");
            }
        }
    });
}
producer.close();
```

åœ¨RabbitMQä¸­ï¼š

```plain
ConnectionFactoryfactory=newConnectionFactory();
factory.setHost("localhost");try (Connectionconnection= factory.newConnection();
     Channelchannel= connection.createChannel()) {
    
    channel.confirmSelect(); // å¯ç”¨å‘å¸ƒç¡®è®¤

    Stringmessage="Hello World!";
    channel.basicPublish("", "my-queue", null, message.getBytes());

    if (channel.waitForConfirms()) {
        System.out.println("Message sent successfully");
    } else {
        System.out.println("Message send failed");
    }
}
```

### æ¶ˆæ¯ä¼ è¾“è¿‡ç¨‹ä¸­çš„å¯é æ€§ä¿è¯
åœ¨ç½‘ç»œä¼ è¾“å¤±è´¥æ—¶è¿›è¡Œé‡è¯•ã€‚åŒæ—¶ä½¿ç”¨ TCPï¼Œç¡®ä¿æ¶ˆæ¯ä¼ è¾“çš„å¯é æ€§ã€‚ åœ¨Kafkaä¸­é…ç½®é‡è¯•æœºåˆ¶ï¼š

```plain
Properties props = new Properties();
props.put("bootstrap.servers", "localhost:9092");
props.put("acks", "all");
props.put("retries", 3); // è®¾ç½®é‡è¯•æ¬¡æ•°
props.put("key.serializer", "org.apache.kafka.common.serialization.StringSerializer");
props.put("value.serializer", "org.apache.kafka.common.serialization.StringSerializer");
Producer<String, String> producer = new KafkaProducer<>(props);
```

### æ¶ˆæ¯å­˜å‚¨è¿‡ç¨‹ä¸­çš„å¯é æ€§ä¿è¯
ç¡®ä¿æ¶ˆæ¯åœ¨ç£ç›˜ä¸ŠæŒä¹…åŒ–å­˜å‚¨ã€‚**Kafka**é»˜è®¤æƒ…å†µä¸‹æ¶ˆæ¯æ˜¯æŒä¹…åŒ–å­˜å‚¨çš„ã€‚**RabbitMQ** åˆ™éœ€è¦è®¾ç½®é˜Ÿåˆ—å’Œæ¶ˆæ¯ä¸ºæŒä¹…åŒ–ã€‚ åœ¨RabbitMQä¸­è®¾ç½®æŒä¹…åŒ–ï¼š

```plain
ConnectionFactory factory = new ConnectionFactory();
factory.setHost("localhost");
try (Connection connection = factory.newConnection();
     Channel channel = connection.createChannel()) {
    
    boolean durable = true;
    channel.queueDeclare("my-queue", durable, false, false, null); // è®¾ç½®é˜Ÿåˆ—ä¸ºæŒä¹…åŒ–

    String message = "Hello World!";
    AMQP.BasicProperties props = new AMQP.BasicProperties.Builder()
            .deliveryMode(2) // è®¾ç½®æ¶ˆæ¯ä¸ºæŒä¹…åŒ–
            .build();
    channel.basicPublish("", "my-queue", props, message.getBytes());
}
```

### æ¶ˆæ¯æ¶ˆè´¹è¿‡ç¨‹ä¸­çš„å¯é æ€§ä¿è¯
**æ¶ˆæ¯ç¡®è®¤æœºåˆ¶ï¼ˆConsumer Acknowledgmentï¼‰**ï¼šç¡®ä¿æ¶ˆæ¯è¢«æˆåŠŸå¤„ç†åæ‰ä»é˜Ÿåˆ—ä¸­åˆ é™¤ã€‚æ¯”å¦‚ **Kafka**ä½¿ç”¨æ‰‹åŠ¨æäº¤åç§»é‡ã€‚**RabbitMQ** åˆ™ä½¿ç”¨æ‰‹åŠ¨ç¡®è®¤æœºåˆ¶ï¼ˆmanual acknowledgmentï¼‰ã€‚

åœ¨Kafkaä¸­æ‰‹åŠ¨æäº¤åç§»é‡ï¼š

```plain
Properties props = new Properties();
props.put("bootstrap.servers", "localhost:9092");
props.put("group.id", "my-group");
props.put("enable.auto.commit", "false"); // ç¦ç”¨è‡ªåŠ¨æäº¤
props.put("key.deserializer", "org.apache.kafka.common.serialization.StringDeserializer");
props.put("value.deserializer", "org.apache.kafka.common.serialization.StringDeserializer");
KafkaConsumer<String, String> consumer = new KafkaConsumer<>(props);
consumer.subscribe(Arrays.asList("my-topic"));

while (true) {
    ConsumerRecords<String, String> records = consumer.poll(Duration.ofMillis(100));
    for (ConsumerRecord<String, String> record : records) {
        System.out.printf("offset = %d, key = %s, value = %s%n", record.offset(), record.key(), record.value());
        // å¤„ç†æ¶ˆæ¯
    }
    consumer.commitSync(); // æ‰‹åŠ¨æäº¤åç§»é‡
}
```

åœ¨RabbitMQä¸­ä½¿ç”¨æ‰‹åŠ¨ç¡®è®¤æœºåˆ¶ï¼š

```plain
ConnectionFactory factory = new ConnectionFactory();
factory.setHost("localhost");
Connection connection = factory.newConnection();
Channel channel = connection.createChannel();

boolean autoAck = false; // ç¦ç”¨è‡ªåŠ¨ç¡®è®¤
channel.basicConsume("my-queue", autoAck, (consumerTag, delivery) -> {
    String message = new String(delivery.getBody(), "UTF-8");
    System.out.println("Received '" + message + "'");
    // å¤„ç†æ¶ˆæ¯
    channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false); // æ‰‹åŠ¨ç¡®è®¤
}, consumerTag -> { });
```

## å…¶ä»–æ³¨æ„äº‹é¡¹
**1ã€ ç›‘æ§å’ŒæŠ¥è­¦**ï¼šå®æ—¶ç›‘æ§æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿçš„è¿è¡ŒçŠ¶æ€ï¼Œè®¾ç½®æŠ¥è­¦æœºåˆ¶ï¼ŒåŠæ—¶å‘ç°å’Œå¤„ç†æ¶ˆæ¯ä¸¢å¤±é—®é¢˜ã€‚

**2ã€ æ—¥å¿—è®°å½•**ï¼šè®°å½•æ¶ˆæ¯çš„ç”Ÿäº§ã€ä¼ è¾“ã€å­˜å‚¨å’Œæ¶ˆè´¹æ—¥å¿—ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥å’Œæ¢å¤ã€‚

**3ã€ æ¶ˆæ¯é‡è¯•æœºåˆ¶**ï¼šé…ç½®åˆç†çš„æ¶ˆæ¯é‡è¯•æœºåˆ¶ï¼Œç¡®ä¿åœ¨å¤„ç†å¤±è´¥æ—¶è¿›è¡Œé‡è¯•ã€‚

**4ã€ é«˜å¯ç”¨éƒ¨ç½²**ï¼šéƒ¨ç½²é«˜å¯ç”¨é›†ç¾¤ï¼Œç¡®ä¿åœ¨èŠ‚ç‚¹æ•…éšœæ—¶ç³»ç»Ÿèƒ½å¤Ÿè‡ªåŠ¨åˆ‡æ¢ï¼Œé¿å…æ¶ˆæ¯ä¸¢å¤±ã€‚



> åŸæ–‡: <https://www.yuque.com/jingdianjichi/xyxdsi/lskgbf55ax5xm7n8>