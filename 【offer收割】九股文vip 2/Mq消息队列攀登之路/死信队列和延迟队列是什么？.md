# 👌死信队列和延迟队列是什么？

# 口语化回答
好的，面试官。死信队列用于存储那些无法被正常处理的消息。这些消息被称为“死信消息”。经常主要是比如某些消息已经被消费了多次依然失败，抛回队列。这种为了不影响正常队列的消息，有时会把它放到死信队列。延迟队列主要是存储那些需要在指定时间后才能被消费的消息。消息在发送到延迟队列后，会在设定的延迟时间到达后才被投递到目标队列供消费者消费。比如我们有时候希望指定的时间触发某个动作。还有一个经典的例子，正常自产自销的 mq，发送消息后，应用接受 mq 然后去数据库查询，查走从库，写走主库，有时候因为主从同步延迟，消费 mq 的时候，无法查到数据，这个时候，可以延迟个 100ms 消费，就可以很巧妙的解决。以上

# 题目解析
两个基础概念，大家了解一下即可。不常问。

# 面试得分点
无法被正常处理，多次失败，指定时间消费

# 题目详细答案
## 死信队列（DLQ）
死信队列用于存储那些无法被正常处理的消息。这些消息被称为“死信消息”。消息进入死信队列的原因通常包括：

1、消息被消费多次但仍然处理失败。

2、消息在队列中存活时间超过了最大时间限制。

3、消息被拒绝（例如，消费者明确拒绝处理该消息）。

### 使用场景
**错误处理**：当消息处理失败多次后，将其放入死信队列，可以进行后续的人工干预或特殊处理。

**监控和报警**：通过监控死信队列，可以发现系统中的异常情况，及时进行报警和处理。

**消息审计**：对死信队列中的消息进行审计，分析系统中可能存在的问题。

### 实现方法
**配置死信策略**：在消息队列系统中配置死信策略，如最大重试次数、消息存活时间等。

**专用死信队列**：为每个队列配置一个专用的死信队列，存储无法处理的消息。

**消费者处理**：设置专门的消费者处理死信队列中的消息，进行日志记录、报警或其他处理。

## 延迟队列
延迟队列用于存储那些需要在指定时间后才能被消费的消息。消息在发送到延迟队列后，会在设定的延迟时间到达后才被投递到目标队列供消费者消费。

### 使用场景
**定时任务**：实现定时任务调度，如在指定时间发送通知、执行任务等。

**重试机制**：在消息处理失败后，将消息放入延迟队列，等待一段时间后再重新处理。

### 实现方法
**消息定时属性**：为消息设置定时属性，如延迟时间、到期时间等。

**时间轮算法**：使用时间轮算法管理延迟消息，定时检查并将到期的消息投递到目标队列。



> 原文: <https://www.yuque.com/jingdianjichi/xyxdsi/gdfldgndsxbkn6ko>