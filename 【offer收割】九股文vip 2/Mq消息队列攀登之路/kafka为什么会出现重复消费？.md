# 👌kafka为什么会出现重复消费？

[此处为语雀卡片，点击链接查看](https://www.yuque.com/jingdianjichi/xyxdsi/lkx75tsxmyymm4gg#hIcfg)

# 口语化回答
好的，面试官。kafka 出现重复消费，常见的原因就是重试机制，偏移量错位，或者重启等等，当生产者发送消息失败时，可能会进行重试。如果生产者在重试过程中成功发送了消息，但消费者在处理过程中未能正确提交偏移量，则这些消息可能会被重新消费，导致重复消费。又或者消费者在处理消息后需要提交偏移量，以告知 Kafka 已成功消费该消息。如果提交偏移量的操作失败，则消费者可能会在下次启动时重新消费这些消息，导致重复消费。以上。

# 题目解析
重复消费也是经常讨论的一个问题，但是套路比较好答，大家可以选择其中三点就可以了。比较好说的是，重试，偏移量或者重启。

# 面试得分点
# 题目详细答案
## 消费者重启或崩溃
当消费者重启或崩溃时，可能会重新读取某些消息，导致重复消费。这种情况通常发生在消费者在处理消息后尚未提交偏移量（Offset）时。由于 Kafka 的消费是基于偏移量的，如果偏移量未提交，消费者重启后会从上次提交的偏移量开始重新消费，导致重复消费。

## 消费者组再平衡
Kafka 使用消费者组（Consumer Group）来实现消息的负载均衡和容错性。当消费者组中的消费者数量发生变化（例如新增或移除消费者），Kafka 会触发再平衡操作。在再平衡期间，分区的所有权可能会转移到不同的消费者，这可能导致某些消息被重新处理，从而出现重复消费。

## 生产者重试机制
当生产者发送消息失败时，可能会进行重试。如果生产者在重试过程中成功发送了消息，但消费者在处理过程中未能正确提交偏移量，则这些消息可能会被重新消费，导致重复消费。

## 消费者提交偏移量失败
消费者在处理消息后需要提交偏移量，以告知 Kafka 已成功消费该消息。如果提交偏移量的操作失败（例如网络问题或 Kafka 集群故障），则消费者可能会在下次启动时重新消费这些消息，导致重复消费。

## 分区副本切换
在 Kafka 集群中，如果 Leader 副本发生故障，Kafka 会将 Leader 角色切换到其他 Follower 副本。在切换过程中，可能会导致某些消息的偏移量信息不一致，导致消费者重复消费这些消息。



> 原文: <https://www.yuque.com/jingdianjichi/xyxdsi/lkx75tsxmyymm4gg>