# 什么是前缀索引？

# 题目详细答案
前缀索引（Prefix Index）是一种索引类型，用于对字符串类型的列（如CHAR、VARCHAR、TEXT等）进行部分索引。通过索引字符串的前一部分，而不是整个字符串，可以显著减少索引的大小，从而提高查询性能，特别是在处理大量数据时。比如一个字符串有 30 个字符，建立索引的时候，发现取前 10 个字符就可以区分出来，这样就可以减少索引大小，也就是前缀索引。

## 使用场景
字符串列的长度较长，且前几位字符就能区分大多数记录。

需要减少索引的存储空间。

# 索引选择性
这里要了解一个概念，索引的选择性（Index Selectivity），是指不重复的索引值和数据表的记录总数的比值。索引的选择性越高则查询效率越高。

前缀索引的目的其实就是性能和空间中找到一个平衡。假设现在有几条记录。

vceina12312-ceince

vceina1demiwad

dwianfgein-ceicenm

假设我们取前 7 位来建立前缀索引，就得到如下结果：

vceina1

vceina1

dwianfg

也就是有两条记录是相同的，那么 2/3 = 0.666666 这就是选择性得到的值。

那假设扩展到 8 位来建立索引呢。

vceina12

vceina1d

dwianfge

用 8 位我们就可以区分出来，找到一条记录。那相比最上面的数据，我们的空间就变小了。所以前缀索引的选择性，最好要接近于正常数据的量。

可以通过如下公式计算：

全列的数为

```sql
SELECT COUNT(DISTINCT column_name) / COUNT(*) FROM table_name;
```

某一长度前缀的选择性

```sql
SELECT COUNT(DISTINCT LEFT(column_name, prefix_length)) / COUNT(*) FROM table_name;
```

如果二者计算结果约等于全列选择性的时候，就是最佳结果。

## 如何创建前缀索引
创建前缀索引时，需要指定要索引的前缀长度。前缀长度应根据实际数据分布和查询需求来确定，一般选择能够有效区分数据的最小长度。

假设有一个包含URL的表websites，其结构如下：

```sql
CREATE TABLE websites (
  id INT AUTO_INCREMENT PRIMARY KEY,
  url VARCHAR(255)
);
```

如果我们希望对url列创建前缀索引，可以使用如下的SQL语句：

```sql
CREATE INDEX idx_url_prefix ON websites (url(10));
```

上述语句创建了一个前缀长度为10的索引，即只对url列的前10个字符进行索引。

## 前缀索引的优缺点
### 优点
**减少索引大小**：前缀索引只索引字符串的前部分字符，显著减少了索引占用的存储空间。

**提高性能**：在某些情况下，较小的索引可以提高查询性能，特别是在内存有限的情况下。

### 缺点
**精确性降低**：前缀索引可能无法完全区分所有记录，特别是前缀部分相同的记录。在这种情况下，可能需要进行额外的行扫描来完成查询。

**适用场景有限**：前缀索引主要适用于字符串列，对于其他类型的列（如整数、日期等）不适用。

## 注意事项
**选择合适的前缀长度**：前缀长度过短可能导致索引选择性差，前缀长度过长则无法充分减少索引大小。需要根据数据分布和查询需求选择合适的前缀长度。

**不适用于ORDER BY和GROUP BY**：前缀索引在某些查询（如ORDER BY和GROUP BY）中可能无法使用，因为这些操作需要完整的列值。



> 原文: <https://www.yuque.com/jingdianjichi/xyxdsi/mfwpn0rvvtvuv58p>