# 👌es 读数据过程是怎么样的？

### 1. 接收请求
客户端发送一个查询请求（如`search`请求）到 Elasticsearch 集群时，请求会被发送到一个节点，这个节点称为协调节点（Coordinating Node）。

### 2. 解析请求
协调节点解析查询请求，理解查询的内容、目标索引和查询参数。

### 3. 路由查询
协调节点根据查询请求的目标索引和分片数，将查询请求路由到相关的分片。对于每个索引，查询请求会被路由到该索引的所有主分片和副本分片。

### 4. 分片查询
每个目标分片（包括主分片和副本分片）接收到查询请求后，执行以下操作：

#### a. 查询执行
+ **查询解析**：解析查询语句，生成查询计划。
+ **查询执行**：在分片的倒排索引（Inverted Index）中执行查询，查找匹配的文档。

#### b. 收集结果
+ **文档收集**：将匹配的文档 ID 和相关数据收集起来。
+ **排序和聚合**：如果查询包含排序或聚合操作，分片会在本地执行这些操作。

### 5. 结果合并
协调节点收集所有分片的查询结果，执行以下操作：

#### a. 合并结果
+ **结果合并**：将来自不同分片的查询结果合并在一起。
+ **全局排序**：如果查询包含排序操作，协调节点会对所有分片的结果进行全局排序。
+ **全局聚合**：如果查询包含聚合操作，协调节点会对所有分片的聚合结果进行全局合并。

### 6. 返回结果
协调节点将最终的查询结果返回给客户端。



> 原文: <https://www.yuque.com/jingdianjichi/xyxdsi/yl6fpi3yguw8lr7g>