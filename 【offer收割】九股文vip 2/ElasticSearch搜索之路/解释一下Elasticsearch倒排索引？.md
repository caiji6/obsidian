# 👌解释一下Elasticsearch倒排索引？

倒排索引是 Elasticsearch 实现快速全文搜索的核心数据结构。通过将词语映射到文档，倒排索引大大提高了搜索效率，支持多种复杂查询，并且能够实时更新。

### 基本概念
1. **正排索引**：
    - 传统的正排索引是指文档到词语的映射，即每个文档包含哪些词语。
    - 这种索引方式在搜索时效率较低，因为需要逐个文档进行扫描，找到包含查询词语的文档。
2. **倒排索引**：
    - 倒排索引是词语到文档的映射，即每个词语在哪些文档中出现。
    - 这种索引方式大大提高了搜索效率，因为只需查找包含查询词语的文档列表即可。

### 倒排索引的结构
倒排索引主要由以下几个部分组成：

1. **词典（Dictionary）**：
    - 词典包含所有在文档集合中出现的词语。
    - 每个词语在词典中都有一个唯一的标识。
2. **倒排列表（Posting List）**：
    - 每个词语对应一个倒排列表，记录了该词语在哪些文档中出现。
    - 倒排列表通常包含文档 ID（Document ID）和词语在文档中的位置信息（Position）。

### 倒排索引的构建过程
1. **文档分词**：
    - 首先，对每个文档进行分词处理，将文档拆分成单个的词语。
    - 例如，文档 "Elasticsearch is a search engine" 会被分成 ["Elasticsearch", "is", "a", "search", "engine"]。
2. **建立词典**：
    - 将所有出现的词语添加到词典中，并为每个词语分配一个唯一的标识。
3. **生成倒排列表**：
    - 对每个词语，记录它在哪些文档中出现，以及在每个文档中的具体位置。
    - 例如，词语 "search" 可能对应的倒排列表是 [(doc1, pos4), (doc2, pos7)]，表示 "search" 出现在 doc1 的第 4 个位置和 doc2 的第 7 个位置。

### 倒排索引的查询过程
1. **查询解析**：
    - 用户输入查询词语，Elasticsearch 解析查询，找到对应的词语。
    - 例如，查询 "search engine" 会被解析为 ["search", "engine"]。
2. **查找倒排列表**：
    - Elasticsearch 在词典中查找每个查询词语，获取对应的倒排列表。
    - 例如，"search" 的倒排列表是 [(doc1, pos4), (doc2, pos7)]，"engine" 的倒排列表是 [(doc1, pos5), (doc3, pos3)]。
3. **合并结果**：
    - 将各个词语的倒排列表合并，找到包含所有查询词语的文档。
    - 例如，"search engine" 的查询结果是 doc1，因为 doc1 同时包含 "search" 和 "engine"。

### 优势与特点
+ **高效查询**：倒排索引使得查找包含特定词语的文档非常高效，无需扫描整个文档集合。
+ **支持复杂查询**：倒排索引不仅支持简单的词语匹配，还支持布尔查询、短语查询、范围查询等复杂查询。
+ **实时更新**：Elasticsearch 支持实时更新倒排索引，允许在文档更新后立即进行搜索。



> 原文: <https://www.yuque.com/jingdianjichi/xyxdsi/zhl0ich60a1pwgq5>