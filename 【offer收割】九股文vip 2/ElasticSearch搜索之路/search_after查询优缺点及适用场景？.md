# 👌search_after 查询优缺点及适用场景？

`search_after`是 Elasticsearch 提供的一种用于分页查询的机制，特别适合处理深度分页和大数据量的查询场景。以下是`search_after`的优缺点及适用场景：

### 优点
1. **高效处理深度分页**：

`search_after`基于游标的分页方式，可以避免深度分页时性能的急剧下降。传统的分页（如`from`和`size`参数）在处理大量数据时，性能会显著下降，因为每次都需要跳过大量数据。

1. **稳定的结果集**：

`search_after`使用上一个结果集的最后一个文档的排序值作为游标，这样可以确保在分页过程中不会遗漏或重复文档，即使在数据发生变化的情况下（如有新的文档插入）。

1. **适合实时数据**：

由于`search_after`不依赖于固定的偏移量，它在处理实时数据查询时表现得更为稳定和高效。

### 缺点
1. **需要全局唯一且稳定的排序字段**：

`search_after`需要一个全局唯一且稳定的排序字段（如`_id`或时间戳），以确保分页的准确性。如果排序字段在分页过程中发生变化，可能会导致结果集不一致。

1. **不适合随机访问**：

`search_after`适用于顺序访问数据，而不适合随机访问特定页的数据。如果需要直接访问某一特定页的数据，`search_after`并不适用。

1. **复杂性增加**：

实现`search_after`需要在每次查询时保存上一个结果集的最后一个文档的排序值，并在下次查询时使用这个值，增加了实现的复杂性。

### 适用场景
1. **深度分页查询**：

当需要分页访问大量数据时，`search_after`能够提供比传统分页更高的性能和稳定性。例如，浏览电商平台上具有大量商品的搜索结果时。

1. **实时数据处理**：

在处理实时数据（如日志分析、实时监控等）时，`search_after`能够确保分页结果的稳定性，即使数据在不断变化。

1. **大数据量的批量处理**：

在需要批量处理大量数据时，`search_after`可以有效避免因跳过大量数据而导致的性能问题。例如，批量导出数据或批量数据处理任务



> 原文: <https://www.yuque.com/jingdianjichi/xyxdsi/yss81r0gew3six22>