# 👌什么是虚拟内存？

虚拟内存（Virtual Memory）是一种计算机系统内存管理技术，它为应用程序提供了一个假象，使其认为自己拥有连续的、独占的内存空间，而实际上这些内存可能被分散在物理内存和磁盘存储中。虚拟内存通过硬件和操作系统的软件协同工作来实现。

### 虚拟内存的基本概念
1. **虚拟地址空间**：

每个进程都有一个独立的虚拟地址空间，进程中的每个地址都是虚拟地址。虚拟地址空间通常比物理内存大得多。

1. **页（Page）和页框（Page Frame）**：

虚拟内存将内存划分为固定大小的块，称为页（通常为4KB或更大）。物理内存也被划分为相同大小的块，称为页框。虚拟页通过页表映射到物理页框。

1. **页表（Page Table）**：

页表是一个数据结构，存储虚拟地址到物理地址的映射关系。每个进程都有自己的页表。

1. **页面置换**：

当物理内存不足时，操作系统会将一些不常用的页面从物理内存移到磁盘（称为交换区或页面文件），并在需要时将其调回内存。这一过程称为页面置换。

### 虚拟内存的工作原理
1. **地址转换**：

当进程访问内存时，CPU生成虚拟地址。这个虚拟地址通过页表转换为物理地址，实际访问物理内存。

硬件中的内存管理单元（MMU, Memory Management Unit）负责进行虚拟地址到物理地址的转换。

1. **页面调度**：

如果访问的虚拟页在物理内存中，则直接访问。如果不在（发生缺页中断），操作系统将从磁盘中加载页面到物理内存，并更新页表。

1. **页面置换算法**：

操作系统使用页面置换算法（如LRU、FIFO等）决定哪些页面需要从物理内存移到磁盘，以腾出空间给新的页面。

### 虚拟内存的优点
1. **内存保护**：

每个进程有独立的虚拟地址空间，互不干扰，提高了系统的稳定性和安全性。

1. **内存扩展**：

虚拟内存允许程序使用比实际物理内存更大的地址空间，通过将不常用的页面存储在磁盘上，扩展了可用内存。

1. **内存共享**：

不同进程可以共享相同的物理内存页面（如共享库），减少内存使用，提高效率。

1. **简化编程**：

程序员可以假定有足够的连续内存空间，无需考虑物理内存的实际布局。

### 虚拟内存的缺点
1. **性能开销**：

地址转换和页面调度增加了系统开销，尤其是发生缺页中断时，会导致性能下降。

1. **复杂性**：

实现虚拟内存需要复杂的硬件和软件支持，增加了系统设计和维护的复杂性。



> 原文: <https://www.yuque.com/jingdianjichi/xyxdsi/wk2ukozlctvqmly3>