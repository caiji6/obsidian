# 👌Spring循环依赖问题是什么？

# 口语化回答
好的，面试官，Spring循环依赖问题是指在Spring容器中，两个或多个Bean之间存在直接的或间接的依赖关系，导致在创建和初始化这些Bean时形成了一个闭环，使得无法正确地创建和初始化这些Bean。主要有两种形式，一种是构造器循环依赖，一种是 setter 方式的循环依赖。构造器循环依赖主要是 Bean A的构造器需要Bean B作为参数，而Bean B的构造器又需要Bean A作为参数。由于构造器是在Bean实例化时调用的，所以Spring容器无法先创建其中一个Bean，因为这样会导致另一个Bean无法实例化，从而形成死循环。setter 循环依赖发生在Bean的setter注入方法中。与构造器循环依赖不同，setter注入是在Bean实例化之后进行的。如果循环依赖关系复杂或配置不当，也可能导致Spring容器无法正确初始化Bean。Spring容器采用了三级缓存机制来处理setter注入的循环依赖。以上。

# 题目解析
经典必问，spring 循环依赖是一个经典的问题，这一题大家解释清两种的方式，再给面试官埋一个三级缓存解决问题的钩子即可。

# 面试得分点
构造器循环依赖，setter 循环依赖，三级缓存

# 题目详细答案
Spring循环依赖问题是指在Spring容器中，两个或多个Bean之间存在直接的或间接的依赖关系，导致在创建和初始化这些Bean时形成了一个闭环，使得Spring容器无法正确地创建和初始化这些Bean。

循环依赖主要分为两种类型：

**构造器循环依赖**：这种循环依赖发生在Bean之间的构造器相互引用。例如，Bean A的构造器需要Bean B作为参数，而Bean B的构造器又需要Bean A作为参数。由于构造器是在Bean实例化时调用的，所以Spring容器无法先创建其中一个Bean，因为这样会导致另一个Bean无法实例化，从而形成死循环。

**setter循环依赖**：这种循环依赖发生在Bean的setter注入方法中。与构造器循环依赖不同，setter注入是在Bean实例化之后进行的。因此，即使存在循环依赖，Spring容器也可以先实例化每个Bean，然后再通过setter方法注入依赖。然而，如果循环依赖关系复杂或配置不当，也可能导致Spring容器无法正确初始化Bean。

为了解决循环依赖问题，Spring容器采用了三级缓存机制来处理setter注入的循环依赖。在Bean实例化过程中，Spring容器会将Bean的实例和ObjectFactory放入不同的缓存中，以便在后续的依赖注入过程中使用。如果Spring容器检测到循环依赖，它会从缓存中获取Bean的实例或ObjectFactory来完成注入，从而解决循环依赖问题。

然而，对于构造器循环依赖，Spring容器无法通过缓存机制来解决，因为它需要在Bean实例化之前注入依赖。因此，如果应用程序中存在构造器循环依赖，Spring容器将无法正确创建和初始化Bean，并抛出相应的异常。

为了避免循环依赖问题，最佳的做法是重新设计代码结构，确保Bean之间的依赖关系是单向的，并尽量减少Bean之间的直接依赖。这可以通过引入接口、使用依赖注入框架的特定功能（如@Autowired注解的按类型自动装配）、或者利用设计模式（如工厂模式、代理模式等）来实现。



> 原文: <https://www.yuque.com/jingdianjichi/xyxdsi/qka3cz64np68do8u>