# ğŸ‘Œçº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ

# é¢˜ç›®è¯¦ç»†ç­”æ¡ˆ
å½“çº¿ç¨‹æ± çš„ä»»åŠ¡ç¼“å­˜é˜Ÿåˆ—å·²æ»¡å¹¶ä¸”çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ç›®è¾¾åˆ°maximumPoolSizeæ—¶ï¼Œå¦‚æœè¿˜æœ‰ä»»åŠ¡åˆ°æ¥å°±ä¼šé‡‡å–ä»»åŠ¡æ‹’ç»ç­–ç•¥ï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å·²ç»ç”¨å®Œäº†ï¼Œæ— æ³•ç»§ç»­ä¸ºæ–°ä»»åŠ¡æœåŠ¡ï¼ŒåŒæ—¶ï¼Œç­‰å¾…é˜Ÿåˆ—ä¹Ÿå·²ç»æ’æ»¡äº†ï¼Œå†ä¹Ÿå¡ä¸ä¸‹æ–°ä»»åŠ¡äº†ã€‚è¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦æ‹’ç»ç­–ç•¥æœºåˆ¶åˆç†çš„å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚

Javaçš„java.util.concurrentåŒ…ä¸­æä¾›äº†å‡ ç§å†…ç½®çš„æ‹’ç»ç­–ç•¥ï¼Œé€šè¿‡å®ç°RejectedExecutionHandleræ¥å£æ¥å®šä¹‰å®ƒä»¬ã€‚ä»¥ä¸‹æ˜¯å‡ ç§å¸¸è§çš„æ‹’ç»ç­–ç•¥ï¼š

## AbortPolicyï¼ˆé»˜è®¤ç­–ç•¥ï¼‰
æŠ›å‡ºRejectedExecutionExceptionå¼‚å¸¸ï¼Œé€šçŸ¥è°ƒç”¨è€…ä»»åŠ¡è¢«æ‹’ç»ã€‚

```plain
RejectedExecutionHandler handler = new ThreadPoolExecutor.AbortPolicy();
```

## CallerRunsPolicy
ç”±è°ƒç”¨çº¿ç¨‹ï¼ˆæäº¤ä»»åŠ¡çš„çº¿ç¨‹ï¼‰ç›´æ¥è¿è¡Œè¢«æ‹’ç»çš„ä»»åŠ¡ã€‚è¿™ç§ç­–ç•¥æä¾›äº†ä¸€ç§ç®€å•çš„åé¦ˆæœºåˆ¶ï¼Œå‡ç¼“æäº¤ä»»åŠ¡çš„é€Ÿåº¦ã€‚

```plain
RejectedExecutionHandler handler = new ThreadPoolExecutor.CallerRunsPolicy();
```

## DiscardPolicy
ç›´æ¥ä¸¢å¼ƒè¢«æ‹’ç»çš„ä»»åŠ¡ï¼Œä¸åšä»»ä½•å¤„ç†ï¼Œä¹Ÿä¸æŠ›å‡ºå¼‚å¸¸ã€‚

```plain
RejectedExecutionHandler handler = new ThreadPoolExecutor.DiscardPolicy();
```

## DiscardOldestPolicy
ä¸¢å¼ƒæœ€æ—©æäº¤çš„æœªå¤„ç†ä»»åŠ¡ï¼Œç„¶åé‡æ–°å°è¯•æ‰§è¡Œå½“å‰è¢«æ‹’ç»çš„ä»»åŠ¡ã€‚

```plain
RejectedExecutionHandler handler = new ThreadPoolExecutor.DiscardOldestPolicy();
```

## è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥
é™¤äº†å†…ç½®çš„æ‹’ç»ç­–ç•¥ï¼Œè¿˜å¯ä»¥é€šè¿‡å®ç°RejectedExecutionHandleræ¥å£æ¥å®šä¹‰è‡ªå·±çš„æ‹’ç»ç­–ç•¥ã€‚

```plain
public class CustomRejectedExecutionHandler implements RejectedExecutionHandler {
    @Override
    public void rejectedExecution(Runnable r, ThreadPoolExecutor executor) {
        // è‡ªå®šä¹‰çš„æ‹’ç»å¤„ç†é€»è¾‘
        System.out.println("Task " + r.toString() + " rejected");
    }
}

// ä½¿ç”¨è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥
RejectedExecutionHandler handler = new CustomRejectedExecutionHandler();
```

## ä½¿ç”¨æ‹’ç»ç­–ç•¥
åœ¨åˆ›å»ºThreadPoolExecutoræ—¶ï¼Œå¯ä»¥å°†æ‹’ç»ç­–ç•¥ä½œä¸ºå‚æ•°ä¼ å…¥ï¼š

```plain
ThreadPoolExecutor executor = new ThreadPoolExecutor(
    corePoolSize,
    maximumPoolSize,
    keepAliveTime,
    timeUnit,
    workQueue,
    handler // ä¼ å…¥æ‹’ç»ç­–ç•¥
);
```

## ä»£ç  Demo
```plain
import java.util.concurrent.*;

public class RejectionPolicyExample {
    public static void main(String[] args) {
        int corePoolSize = 2;
        int maximumPoolSize = 4;
        long keepAliveTime = 10;
        TimeUnit timeUnit = TimeUnit.SECONDS;
        BlockingQueue<Runnable> workQueue = new ArrayBlockingQueue<>(2);

        // ä½¿ç”¨AbortPolicyä½œä¸ºæ‹’ç»ç­–ç•¥
        RejectedExecutionHandler handler = new ThreadPoolExecutor.AbortPolicy();

        ThreadPoolExecutor executor = new ThreadPoolExecutor(
            corePoolSize,
            maximumPoolSize,
            keepAliveTime,
            timeUnit,
            workQueue,
            handler
        );

        for (int i = 0; i < 10; i++) {
            executor.execute(new Task(i));
        }

        executor.shutdown();
    }

    static class Task implements Runnable {
        private final int taskId;

        Task(int taskId) {
            this.taskId = taskId;
        }

        @Override
        public void run() {
            System.out.println("Executing task " + taskId);
            try {
                Thread.sleep(1000);
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
        }

        @Override
        public String toString() {
            return "Task " + taskId;
        }
    }
}
```

çº¿ç¨‹æ± ä½¿ç”¨AbortPolicyä½œä¸ºæ‹’ç»ç­–ç•¥ã€‚å½“ä»»åŠ¡æ•°é‡è¶…è¿‡çº¿ç¨‹æ± çš„å¤„ç†èƒ½åŠ›æ—¶ï¼Œå°†æŠ›å‡ºRejectedExecutionExceptionã€‚é»˜è®¤çš„æ‹’ç»ç­–ç•¥æ˜¯AbortPolicyã€‚



> åŸæ–‡: <https://www.yuque.com/jingdianjichi/xyxdsi/hhe1698hk34m3gv8>