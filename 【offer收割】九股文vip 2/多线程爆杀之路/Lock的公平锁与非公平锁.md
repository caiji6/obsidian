# ðŸ‘ŒLockçš„å…¬å¹³é”ä¸Žéžå…¬å¹³é”

# é¢˜ç›®è¯¦ç»†ç­”æ¡ˆ
## å…¬å¹³é”ä¸Žéžå…¬å¹³é”çš„æ¦‚å¿µ
**å…¬å¹³é”ï¼ˆFair Lockï¼‰**ï¼šå…¬å¹³é”æŒ‰ç…§çº¿ç¨‹è¯·æ±‚é”çš„é¡ºåºï¼ˆFIFOï¼‰åˆ†é…é”ã€‚è¿™æ„å‘³ç€ç­‰å¾…æ—¶é—´æœ€é•¿çš„çº¿ç¨‹æœ€å…ˆèŽ·å¾—é”ï¼Œç¡®ä¿é”çš„åˆ†é…æ˜¯å…¬å¹³çš„ã€‚

**éžå…¬å¹³é”ï¼ˆNon-Fair Lockï¼‰**ï¼šéžå…¬å¹³é”ä¸ä¿è¯é”çš„åˆ†é…é¡ºåºï¼Œå¯èƒ½ä¼šè®©æŸäº›çº¿ç¨‹â€œæ’é˜Ÿâ€ï¼Œä»Žè€Œå¯èƒ½å¯¼è‡´æŸäº›çº¿ç¨‹é•¿æ—¶é—´ç­‰å¾…é”ã€‚

## ReentrantLockçš„å…¬å¹³æ€§
ReentrantLockæ˜¯LockæŽ¥å£çš„ä¸€ä¸ªå¸¸ç”¨å®žçŽ°ï¼Œå®ƒå¯ä»¥é…ç½®ä¸ºå…¬å¹³é”æˆ–éžå…¬å¹³é”ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒReentrantLockæ˜¯éžå…¬å¹³é”ï¼Œä½†å¯ä»¥é€šè¿‡æž„é€ å‡½æ•°æ¥æŒ‡å®šé”çš„å…¬å¹³æ€§ã€‚

```plain
import java.util.concurrent.locks.ReentrantLock;

public class FairNonFairLockExample {
    private final ReentrantLock fairLock = new ReentrantLock(true); // å…¬å¹³é”
    private final ReentrantLock nonFairLock = new ReentrantLock(false); // éžå…¬å¹³é”

    public void testLock(ReentrantLock lock) {
        try {
            lock.lock();
            System.out.println(Thread.currentThread().getName() + " acquired the lock.");
            Thread.sleep(100);
        } catch (InterruptedException e) {
            e.printStackTrace();
        } finally {
            lock.unlock();
            System.out.println(Thread.currentThread().getName() + " released the lock.");
        }
    }

    public static void main(String[] args) {
        FairNonFairLockExample example = new FairNonFairLockExample();

        Runnable task = () -> {
            for (int i = 0; i < 5; i++) {
                example.testLock(example.fairLock); // æµ‹è¯•å…¬å¹³é”
                // example.testLock(example.nonFairLock); // æµ‹è¯•éžå…¬å¹³é”
            }
        };

        Thread t1 = new Thread(task, "Thread-1");
        Thread t2 = new Thread(task, "Thread-2");
        Thread t3 = new Thread(task, "Thread-3");

        t1.start();
        t2.start();
        t3.start();
    }
}
```

## å…¬å¹³é”ä¸Žéžå…¬å¹³é”çš„ä¼˜ç¼ºç‚¹
#### å…¬å¹³é”çš„ä¼˜ç‚¹
1. **é¿å…çº¿ç¨‹é¥¥é¥¿**ï¼šå…¬å¹³é”æŒ‰ç…§è¯·æ±‚é¡ºåºåˆ†é…é”ï¼Œé¿å…äº†æŸäº›çº¿ç¨‹é•¿æ—¶é—´ç­‰å¾…é”çš„é—®é¢˜ã€‚
2. **å¯é¢„æµ‹æ€§**ï¼šé”çš„åˆ†é…æ˜¯æœ‰åºçš„ï¼Œå®¹æ˜“é¢„æµ‹å’Œè°ƒè¯•ã€‚

#### å…¬å¹³é”çš„ç¼ºç‚¹
1. **æ€§èƒ½å¼€é”€**ï¼šå…¬å¹³é”éœ€è¦ç»´æŠ¤ä¸€ä¸ªé˜Ÿåˆ—æ¥ç®¡ç†çº¿ç¨‹çš„è¯·æ±‚é¡ºåºï¼Œè¿™ä¼šå¸¦æ¥é¢å¤–çš„æ€§èƒ½å¼€é”€ã€‚
2. **åžåé‡è¾ƒä½Ž**ï¼šç”±äºŽå…¬å¹³é”ä¸¥æ ¼æŒ‰ç…§é¡ºåºåˆ†é…é”ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸Šä¸‹æ–‡åˆ‡æ¢é¢‘ç¹ï¼Œé™ä½Žç³»ç»Ÿçš„æ•´ä½“åžåé‡ã€‚

#### éžå…¬å¹³é”çš„ä¼˜ç‚¹
1. **é«˜æ€§èƒ½**ï¼šéžå…¬å¹³é”ä¸éœ€è¦ç»´æŠ¤è¯·æ±‚é˜Ÿåˆ—ï¼Œå‡å°‘äº†æ€§èƒ½å¼€é”€ã€‚
2. **é«˜åžåé‡**ï¼šç”±äºŽå…è®¸çº¿ç¨‹æ’é˜Ÿï¼Œéžå…¬å¹³é”åœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥æé«˜ç³»ç»Ÿçš„æ•´ä½“åžåé‡ã€‚

#### éžå…¬å¹³é”çš„ç¼ºç‚¹
1. **çº¿ç¨‹é¥¥é¥¿**ï¼šæŸäº›çº¿ç¨‹å¯èƒ½é•¿æ—¶é—´æ— æ³•èŽ·å¾—é”ï¼Œå¯¼è‡´çº¿ç¨‹é¥¥é¥¿ã€‚
2. **ä¸å¯é¢„æµ‹æ€§**ï¼šé”çš„åˆ†é…æ˜¯æ— åºçš„ï¼Œå¯èƒ½ä¼šå¯¼è‡´è°ƒè¯•å’Œé¢„æµ‹å˜å¾—å›°éš¾ã€‚



å…¬å¹³é”å’Œéžå…¬å¹³é”åœ¨é”çš„åˆ†é…ç­–ç•¥ä¸Šæœ‰æ‰€ä¸åŒï¼Œå„æœ‰ä¼˜ç¼ºç‚¹ã€‚å…¬å¹³é”ä¿è¯äº†é”çš„åˆ†é…æ˜¯å…¬å¹³çš„ï¼Œé¿å…äº†çº¿ç¨‹é¥¥é¥¿ï¼Œä½†å¯èƒ½ä¼šå¸¦æ¥æ€§èƒ½å¼€é”€å’Œè¾ƒä½Žçš„åžåé‡ã€‚éžå…¬å¹³é”åˆ™é€šè¿‡å…è®¸çº¿ç¨‹æ’é˜Ÿæ¥æé«˜æ€§èƒ½å’Œåžåé‡ï¼Œä½†å¯èƒ½ä¼šå¯¼è‡´çº¿ç¨‹é¥¥é¥¿ã€‚

åœ¨å®žé™…åº”ç”¨ä¸­ï¼Œé€‰æ‹©å…¬å¹³é”è¿˜æ˜¯éžå…¬å¹³é”éœ€è¦æ ¹æ®å…·ä½“çš„åœºæ™¯å’Œéœ€æ±‚æ¥å†³å®šã€‚å¦‚æžœéœ€è¦ä¸¥æ ¼çš„é¡ºåºå’Œå…¬å¹³æ€§ï¼Œå¯ä»¥é€‰æ‹©å…¬å¹³é”ï¼›å¦‚æžœæ›´å…³æ³¨æ€§èƒ½å’Œåžåé‡ï¼Œå¯ä»¥é€‰æ‹©éžå…¬å¹³é”ã€‚



> åŽŸæ–‡: <https://www.yuque.com/jingdianjichi/xyxdsi/ctugk72g247h7hc0>