# ðŸ‘ŒHashMapæ€Žä¹ˆè®¡ç®—hashCodeçš„ï¼Ÿ

# <font style="color:rgb(38, 38, 38);">é¢˜ç›®è¯¦ç»†ç­”æ¡ˆ</font>
HashMapä½¿ç”¨é”®çš„hashCode()æ–¹æ³•æ¥ç”Ÿæˆå“ˆå¸Œå€¼ï¼Œå¹¶å¯¹å…¶è¿›è¡Œä¸€äº›å¤„ç†ï¼Œä»¥æé«˜å“ˆå¸Œè¡¨çš„æ€§èƒ½å’Œå‡åŒ€åˆ†å¸ƒã€‚

## è°ƒç”¨é”®çš„hashCode()æ–¹æ³•
é¦–å…ˆï¼ŒHashMapè°ƒç”¨é”®å¯¹è±¡çš„hashCode()æ–¹æ³•æ¥èŽ·å–ä¸€ä¸ªæ•´æ•°å“ˆå¸Œç ã€‚è¿™ä¸ªå“ˆå¸Œç æ˜¯ç”±é”®å¯¹è±¡çš„ç±»å®šä¹‰çš„ï¼Œé€šå¸¸æ˜¯é€šè¿‡æŸç§ç®—æ³•åŸºäºŽå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€è®¡ç®—å‡ºæ¥çš„ã€‚

```plain
int hashCode= key.hashCode();
```

## æ‰°åŠ¨å‡½æ•° (Perturbation Function)
ä¸ºäº†å‡å°‘å“ˆå¸Œå†²çªå¹¶ä½¿å“ˆå¸Œç æ›´åŠ å‡åŒ€åœ°åˆ†å¸ƒï¼ŒHashMapå¯¹åŽŸå§‹å“ˆå¸Œç è¿›è¡Œäº†ä¸€äº›é¢å¤–çš„å¤„ç†ã€‚è¿™ç§å¤„ç†è¢«ç§°ä¸ºæ‰°åŠ¨å‡½æ•°ã€‚Java 8 åŠä»¥åŽçš„HashMapå®žçŽ°ä½¿ç”¨ä»¥ä¸‹ç®—æ³•æ¥è®¡ç®—æœ€ç»ˆçš„å“ˆå¸Œå€¼ï¼š

```plain
static final int hash(Object key) {
    int h;
    return (key == null) ? 0 : (h = key.hashCode()) ^ (h >>> 16);
}
```

è¿™ä¸ªç®—æ³•çš„æ­¥éª¤å¦‚ä¸‹ï¼š

1. **èŽ·å–é”®çš„å“ˆå¸Œç **ï¼šh = key.hashCode()
2. **å³ç§» 16 ä½**ï¼šh >>> 16
3. **å¼‚æˆ–è¿ç®—**ï¼šh ^ (h >>> 16)

è¿™ç§æ–¹æ³•é€šè¿‡å°†é«˜ä½å’Œä½Žä½çš„å“ˆå¸Œç æ··åˆåœ¨ä¸€èµ·ï¼Œå‡å°‘äº†å“ˆå¸Œå†²çªçš„æ¦‚çŽ‡ï¼Œä»Žè€Œä½¿å¾—å“ˆå¸Œç æ›´åŠ å‡åŒ€åœ°åˆ†å¸ƒåœ¨å“ˆå¸Œè¡¨çš„æ¡¶ä¸­ã€‚

## è®¡ç®—æ•°ç»„ç´¢å¼•
è®¡ç®—å‡ºæ‰°åŠ¨åŽçš„å“ˆå¸Œå€¼åŽï¼ŒHashMapä½¿ç”¨è¿™ä¸ªå€¼æ¥ç¡®å®šé”®å€¼å¯¹åœ¨å“ˆå¸Œè¡¨ä¸­çš„ä½ç½®ã€‚é€šå¸¸ï¼ŒHashMapä½¿ç”¨å“ˆå¸Œå€¼å¯¹æ•°ç»„çš„é•¿åº¦å–æ¨¡ï¼ˆå–ä½™æ•°ï¼‰æ¥è®¡ç®—ç´¢å¼•ï¼š

```plain
int index = (n - 1) & hash;
```

å…¶ä¸­ï¼Œnæ˜¯å“ˆå¸Œè¡¨æ•°ç»„çš„é•¿åº¦ã€‚né€šå¸¸æ˜¯ 2 çš„å¹‚ï¼Œè¿™æ ·(n - 1)å°±æ˜¯ä¸€ä¸ªå…¨ 1 çš„äºŒè¿›åˆ¶æ•°ï¼Œè¿™ä½¿å¾—æŒ‰ä½ä¸Žæ“ä½œ&å¯ä»¥æœ‰æ•ˆåœ°æ›¿ä»£å–æ¨¡æ“ä½œ%ï¼Œä»Žè€Œæé«˜æ€§èƒ½ã€‚

# demo
å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªé”®å¯¹è±¡ï¼Œå…¶hashCode()è¿”å›žå€¼ä¸º 123456ã€‚é‚£ä¹ˆï¼Œè®¡ç®—å“ˆå¸Œå€¼çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š

1. è°ƒç”¨hashCode()æ–¹æ³•ï¼šint hashCode = 123456;
2. æ‰°åŠ¨å‡½æ•°è®¡ç®—ï¼š
    - h = 123456
    - h >>> 16 = 123456 >>> 16 = 1ï¼ˆå³ç§» 16 ä½ï¼‰
    - hash = h ^ (h >>> 16) = 123456 ^ 1 = 123457
3. è®¡ç®—æ•°ç»„ç´¢å¼•ï¼ˆå‡è®¾æ•°ç»„é•¿åº¦nä¸º 16ï¼Œå³n - 1ä¸º 15ï¼‰ï¼š
    - index = (15) & 123457 = 15 & 123457 = 1

æœ€ç»ˆï¼Œé”®å€¼å¯¹å°†å­˜å‚¨åœ¨å“ˆå¸Œè¡¨æ•°ç»„çš„ç´¢å¼• 1 ä½ç½®ã€‚



> åŽŸæ–‡: <https://www.yuque.com/jingdianjichi/xyxdsi/str1ewvagoc4qesr>