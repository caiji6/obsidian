# ğŸ‘Œæ‹‰é“¾æ³•å¯¼è‡´çš„é“¾è¡¨è¿‡æ·±é—®é¢˜ä¸ºä»€ä¹ˆç”¨çº¢é»‘æ ‘ï¼Ÿ

# é¢˜ç›®è¯¦ç»†ç­”æ¡ˆ
åœ¨JDK 8ä¸­ï¼ŒHashMapé‡‡ç”¨çº¢é»‘æ ‘æ¥è§£å†³æ‹‰é“¾æ³•å¯¼è‡´çš„é“¾è¡¨è¿‡æ·±é—®é¢˜ï¼Œä¸»è¦æ˜¯ä¸ºäº†æé«˜åœ¨é«˜å†²çªæƒ…å†µä¸‹çš„æ€§èƒ½ã€‚

## æ‹‰é“¾æ³•ä¸­çš„é“¾è¡¨è¿‡æ·±é—®é¢˜
åœ¨ä¼ ç»Ÿçš„æ‹‰é“¾æ³•ä¸­ï¼Œå½“å¤šä¸ªé”®çš„å“ˆå¸Œå€¼å†²çªæ—¶ï¼Œè¿™äº›é”®ä¼šè¢«å­˜å‚¨åœ¨åŒä¸€ä¸ªæ¡¶ï¼ˆbucketï¼‰ä¸­ï¼Œå½¢æˆä¸€ä¸ªé“¾è¡¨ã€‚å¦‚æœé“¾è¡¨è¿‡é•¿ï¼ŒæŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¼šé€€åŒ–ä¸ºO(n)ï¼Œå…¶ä¸­næ˜¯é“¾è¡¨ä¸­çš„å…ƒç´ ä¸ªæ•°ã€‚è¿™ç§æƒ…å†µä¸‹ï¼ŒHashMapçš„æ€§èƒ½ä¼šæ˜¾è‘—ä¸‹é™ã€‚

## çº¢é»‘æ ‘çš„ä¼˜åŠ¿
çº¢é»‘æ ‘æ˜¯ä¸€ç§è‡ªå¹³è¡¡çš„äºŒå‰æœç´¢æ ‘ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š

1. **è‡ªå¹³è¡¡**ï¼šçº¢é»‘æ ‘é€šè¿‡é¢œè‰²å±æ€§ï¼ˆçº¢è‰²å’Œé»‘è‰²ï¼‰å’Œä¸€ç³»åˆ—çš„æ—‹è½¬æ“ä½œï¼Œä¿è¯æ ‘çš„é«˜åº¦è¿‘ä¼¼å¹³è¡¡ã€‚å…¶é«˜åº¦ä¸ä¼šè¶…è¿‡2 * log(n)ï¼Œå…¶ä¸­næ˜¯æ ‘ä¸­çš„èŠ‚ç‚¹æ•°ã€‚
2. **é«˜æ•ˆçš„æŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤**ï¼šçº¢é»‘æ ‘çš„æŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸ºO(log n)ï¼Œè¿œä¼˜äºé“¾è¡¨åœ¨æœ€åæƒ…å†µä¸‹çš„O(n)ã€‚

## ä¸ºä»€ä¹ˆé€‰æ‹©çº¢é»‘æ ‘
1. **æ€§èƒ½ä¼˜åŒ–**ï¼šåœ¨é“¾è¡¨é•¿åº¦è¾ƒçŸ­æ—¶ï¼Œé“¾è¡¨æ“ä½œçš„æ€§èƒ½æ˜¯å¯ä»¥æ¥å—çš„ã€‚ç„¶è€Œï¼Œå½“é“¾è¡¨é•¿åº¦è¶…è¿‡ä¸€å®šé˜ˆå€¼ï¼ˆJDK 8ä¸­ä¸º8ï¼‰æ—¶ï¼Œé“¾è¡¨æ“ä½œçš„æ€§èƒ½ä¼šæ˜¾è‘—ä¸‹é™ã€‚æ­¤æ—¶ï¼Œå°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œå¯ä»¥å°†æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä»O(n)é™ä½åˆ°O(log n)ï¼Œæ˜¾è‘—æé«˜æ€§èƒ½ã€‚
2. **å¹³è¡¡æ€§**ï¼šçº¢é»‘æ ‘é€šè¿‡è‡ªå¹³è¡¡æœºåˆ¶ï¼Œä¿è¯æ ‘çš„é«˜åº¦å§‹ç»ˆä¿æŒåœ¨ä¸€ä¸ªè¾ƒä½çš„æ°´å¹³ï¼Œé¿å…äº†é“¾è¡¨è¿‡é•¿å¯¼è‡´çš„æ€§èƒ½é—®é¢˜ã€‚
3. **ç©ºé—´æ•ˆç‡**ï¼šè™½ç„¶çº¢é»‘æ ‘æ¯”é“¾è¡¨å ç”¨æ›´å¤šçš„ç©ºé—´ï¼ˆå› ä¸ºéœ€è¦å­˜å‚¨é¢œè‰²å’ŒæŒ‡é’ˆä¿¡æ¯ï¼‰ï¼Œä½†åœ¨é“¾è¡¨é•¿åº¦è¾ƒé•¿æ—¶ï¼Œæ€§èƒ½çš„æå‡é€šå¸¸ä¼šè¶…è¿‡ç©ºé—´å¼€é”€çš„å¢åŠ ã€‚

## å®ç°ç»†èŠ‚
åœ¨JDK 8çš„HashMapä¸­ï¼Œå½“é“¾è¡¨é•¿åº¦è¶…è¿‡é˜ˆå€¼ï¼ˆ8ï¼‰æ—¶ï¼Œä¼šå°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚

```plain
if (binCount >= TREEIFY_THRESHOLD - 1) // -1 for 1st
    treeifyBin(tab, hash);
```

treeifyBinæ–¹æ³•å°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼š

```plain
final void treeifyBin(Node<K,V>[] tab, int hash) {
    int n, index; Node<K,V> e;
    if (tab == null || (n = tab.length) < MIN_TREEIFY_CAPACITY)
        resize();
    else if ((e = tab[index = (n - 1) & hash]) != null) {
        TreeNode<K,V> hd = null, tl = null;
        do {
            TreeNode<K,V> p = replacementTreeNode(e, null);
            if (tl == null)
                hd = p;
            else {
                p.prev = tl;
                tl.next = p;
            }
            tl = p;
        } while ((e = e.next) != null);
        if ((tab[index] = hd) != null)
            hd.treeify(tab);
    }
}
```



> åŸæ–‡: <https://www.yuque.com/jingdianjichi/xyxdsi/slnwlmfri8rykznt>