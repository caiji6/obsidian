# ğŸ‘ŒæœåŠ¡é™çº§çš„å®ç°

### <font style="background-color:rgb(247, 248, 249);">1. ä½¿ç”¨ Spring Boot å’Œ Resilience4j å®ç°æœåŠ¡é™çº§</font>
<font style="background-color:rgb(247, 248, 249);">Resilience4j æ˜¯ä¸€ä¸ªè½»é‡çº§çš„æ•…éšœå®¹é”™åº“ï¼Œæ”¯æŒç†”æ–­ã€é™æµã€é‡è¯•ç­‰å¤šç§åŠŸèƒ½ã€‚</font>

#### <font style="background-color:rgb(247, 248, 249);">1.1 æ·»åŠ ä¾èµ–</font>
<font style="background-color:rgb(247, 248, 249);">åœ¨</font><font style="background-color:rgb(247, 248, 249);"> </font>`<font style="background-color:rgb(247, 248, 249);">pom.xml</font>`<font style="background-color:rgb(247, 248, 249);"> </font><font style="background-color:rgb(247, 248, 249);">æ–‡ä»¶ä¸­æ·»åŠ  Resilience4j å’Œ Spring Boot AOP çš„ä¾èµ–ï¼š</font>

```plain
<dependency>
    <groupId>io.github.resilience4j</groupId>
    <artifactId>resilience4j-spring-boot2</artifactId>
    <version>1.7.0</version>
</dependency>
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-aop</artifactId>
</dependency>
```

#### <font style="background-color:rgb(247, 248, 249);">1.2 é…ç½®ç†”æ–­å™¨</font>
<font style="background-color:rgb(247, 248, 249);">åœ¨</font><font style="background-color:rgb(247, 248, 249);"> </font>`<font style="background-color:rgb(247, 248, 249);">application.yml</font>`<font style="background-color:rgb(247, 248, 249);"> </font><font style="background-color:rgb(247, 248, 249);">æ–‡ä»¶ä¸­é…ç½®ç†”æ–­å™¨å‚æ•°ï¼š</font>

```plain
resilience4j.circuitbreaker:
  instances:
    myService:
      registerHealthIndicator: true
      slidingWindowSize: 10
      failureRateThreshold: 50
      waitDurationInOpenState: 5s
      permittedNumberOfCallsInHalfOpenState: 3
      slidingWindowType: COUNT_BASED
      minimumNumberOfCalls: 10
      automaticTransitionFromOpenToHalfOpenEnabled: true
```

#### <font style="background-color:rgb(247, 248, 249);">1.3 ä½¿ç”¨</font><font style="background-color:rgb(247, 248, 249);"> </font>`<font style="background-color:rgb(247, 248, 249);">@CircuitBreaker</font>`<font style="background-color:rgb(247, 248, 249);"> </font><font style="background-color:rgb(247, 248, 249);">æ³¨è§£</font>
<font style="background-color:rgb(247, 248, 249);">åœ¨æœåŠ¡ç±»ä¸­ä½¿ç”¨</font><font style="background-color:rgb(247, 248, 249);"> </font>`<font style="background-color:rgb(247, 248, 249);">@CircuitBreaker</font>`<font style="background-color:rgb(247, 248, 249);"> </font><font style="background-color:rgb(247, 248, 249);">æ³¨è§£ï¼Œå¹¶å®šä¹‰é™çº§æ–¹æ³•ï¼š</font>

```plain
import io.github.resilience4j.circuitbreaker.annotation.CircuitBreaker;
import org.springframework.stereotype.Service;

@Service
public class MyService {

    @CircuitBreaker(name = "myService", fallbackMethod = "fallback")
    public String callService(String name) {
        if ("fail".equals(name)) {
            throw new RuntimeException("Service failure");
        }
        return "Hello, " + name;
    }

    public String fallback(String name, Throwable throwable) {
        return "Hello, fallback";
    }
}
```

#### <font style="background-color:rgb(247, 248, 249);">1.4 æµ‹è¯•æœåŠ¡é™çº§</font>
<font style="background-color:rgb(247, 248, 249);">ä½¿ç”¨ Spring Boot æµ‹è¯•æ¡†æ¶æµ‹è¯•æœåŠ¡é™çº§çš„è¡Œä¸ºï¼š</font>

```plain
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.CommandLineRunner;
import org.springframework.stereotype.Component;

@Component
public class TestRunner implements CommandLineRunner {

    @Autowired
    private MyService myService;

    @Override
    public void run(String... args) throws Exception {
        for (int i = 0; i < 15; i++) {
            try {
                System.out.println(myService.callService(i < 5 ? "World" : "fail"));
            } catch (Exception e) {
                System.out.println(e.getMessage());
            }
        }
    }
}
```

### <font style="background-color:rgb(247, 248, 249);">3. ä½¿ç”¨ Spring Cloud Netflix Hystrix</font>
<font style="background-color:rgb(247, 248, 249);">åœ¨ Spring Cloud é¡¹ç›®ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Spring Cloud Netflix Hystrix å®ç°æœåŠ¡é™çº§ã€‚</font>

#### <font style="background-color:rgb(247, 248, 249);">3.1 æ·»åŠ ä¾èµ–</font>
<font style="background-color:rgb(247, 248, 249);">åœ¨</font><font style="background-color:rgb(247, 248, 249);"> </font>`<font style="background-color:rgb(247, 248, 249);">pom.xml</font>`<font style="background-color:rgb(247, 248, 249);"> </font><font style="background-color:rgb(247, 248, 249);">æ–‡ä»¶ä¸­æ·»åŠ  Spring Cloud Netflix Hystrix ä¾èµ–ï¼š</font>

```plain
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-netflix-hystrix</artifactId>
</dependency>
```

#### <font style="background-color:rgb(247, 248, 249);">3.2 å¯ç”¨ Hystrix</font>
<font style="background-color:rgb(247, 248, 249);">åœ¨ Spring Boot åº”ç”¨ä¸»ç±»ä¸Šæ·»åŠ </font><font style="background-color:rgb(247, 248, 249);"> </font>`<font style="background-color:rgb(247, 248, 249);">@EnableCircuitBreaker</font>`<font style="background-color:rgb(247, 248, 249);"> </font><font style="background-color:rgb(247, 248, 249);">æ³¨è§£ï¼š</font>

```plain
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.client.circuitbreaker.EnableCircuitBreaker;

@SpringBootApplication
@EnableCircuitBreaker
public class Application {
    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}
```

#### <font style="background-color:rgb(247, 248, 249);">3.3 ä½¿ç”¨</font><font style="background-color:rgb(247, 248, 249);"> </font>`<font style="background-color:rgb(247, 248, 249);">@HystrixCommand</font>`<font style="background-color:rgb(247, 248, 249);"> </font><font style="background-color:rgb(247, 248, 249);">æ³¨è§£</font>
<font style="background-color:rgb(247, 248, 249);">åœ¨æœåŠ¡ç±»ä¸­ä½¿ç”¨</font><font style="background-color:rgb(247, 248, 249);"> </font>`<font style="background-color:rgb(247, 248, 249);">@HystrixCommand</font>`<font style="background-color:rgb(247, 248, 249);"> </font><font style="background-color:rgb(247, 248, 249);">æ³¨è§£ï¼Œå¹¶å®šä¹‰é™çº§æ–¹æ³•ï¼š</font>

```plain
import com.netflix.hystrix.contrib.javanica.annotation.HystrixCommand;
import org.springframework.stereotype.Service;

@Service
public class MyService {

    @HystrixCommand(fallbackMethod = "fallback")
    public String callService(String name) {
        if ("fail".equals(name)) {
            throw new RuntimeException("Service failure");
        }
        return "Hello, " + name;
    }

    public String fallback(String name) {
        return "Hello, fallback";
    }
}
```

### <font style="background-color:rgb(247, 248, 249);">æ€»ç»“</font>
<font style="background-color:rgb(247, 248, 249);">æœåŠ¡é™çº§æ˜¯ä¸€ç§é‡è¦çš„æ•…éšœå¤„ç†ç­–ç•¥ï¼Œé€šè¿‡åœ¨ç³»ç»Ÿé«˜è´Ÿè½½æˆ–éƒ¨åˆ†æœåŠ¡ä¸å¯ç”¨æ—¶é™ä½æŸäº›æœåŠ¡çš„åŠŸèƒ½æˆ–è´¨é‡ï¼Œæ¥ä¿è¯ç³»ç»Ÿçš„æ ¸å¿ƒåŠŸèƒ½å’Œæ•´ä½“ç¨³å®šæ€§ã€‚å¸¸ç”¨çš„å®ç°æ–¹æ³•åŒ…æ‹¬ä½¿ç”¨ Resilience4j å’Œ Hystrix ç­‰åº“ã€‚é€šè¿‡é…ç½®ç†”æ–­å™¨å‚æ•°å’Œé™çº§æ–¹æ³•ï¼Œå¯ä»¥å®ç°è‡ªåŠ¨åŒ–çš„æœåŠ¡é™çº§ï¼Œç¡®ä¿ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§å’Œå¯é æ€§ã€‚</font>



> åŸæ–‡: <https://www.yuque.com/jingdianjichi/xyxdsi/kdgg8rgggoaycdy5>