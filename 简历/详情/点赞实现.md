## 业务需求

首先我们来分析整理一下点赞业务的需求，一个通用点赞系统需要满足下列特性：

![image.png](http://minio.api.crjblog.top/image-host/img/2024/04/10/2024-04-10T16:58:03-af3dbd97.png)

- 通用：点赞业务在设计的时候不要与业务系统耦合，必须同时支持不同业务的点赞功能
    
- 独立：点赞功能是独立系统，并且不依赖其它服务。这样才具备可迁移性。
    
- 并发：一些热点业务点赞会很多，所以点赞功能必须支持高并发
    
- 安全：要做好并发安全控制，避免重复点赞

## 实现思路：

要保证安全，避免重复点赞，我们就必须保存每一次点赞记录。只有这样在下次用户点赞时我们才能查询数据，判断是否是重复点赞。同时，因为业务方经常需要根据点赞数量排序，因此每个业务的点赞数量也需要记录下来。

我们说过点赞服务必须独立，因此必须抽取为一个**独立服务**。多个其它微服务业务的点赞数据都由点赞系统来维护。但是问题来了：

```ad-question
如果业务方需要根据点赞数排序，就必须在数据库中维护点赞数字段。但是点赞系统无法修改其它业务服务的数据库，否则就出现了业务耦合。该怎么办呢？

```

```ad-done
点赞系统可以在点赞数变更时，通过MQ通知业务方，这样业务方就可以更新自己的点赞数量了。并且还避免了点赞系统与业务方的耦合。

```

综上，点赞的基本思路如下：
![image.png](http://minio.api.crjblog.top/image-host/img/2024/04/10/2024-04-10T16:56:01-48ecf0e8.png)
## 数据结构

点赞的数据结构分两部分，一是**点赞记录**，二是与业务关联的**点赞数**。

### ER图

点赞记录本质就是记录**谁给什么内容点了赞**，所以核心属性包括：

- 点赞目标id
    
- 点赞人id
    

不过点赞的内容多种多样，为了加以区分，我们还需要把点赞内的类型记录下来：

- 点赞对象类型（为了通用性）
    

当然还有点赞时间，综上对应的数据库ER图如下：

![image.png](http://minio.api.crjblog.top/image-host/img/2024/04/10/2024-04-10T17:19:44-c7136e26.png)
