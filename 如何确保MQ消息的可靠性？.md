---
title: 如何确保MQ消息的可靠性？
categories:
  - 消息队列
tags:
  - RabbitMQ
---
## 前言

项目开发中经常会使用消息队列来完成异步处理、应用解耦、流量控制等功能。虽然消息队列的出现解决了一些场景下的问题，但是同时也引出了一些问题，其中使用消息队列时如何保证消息的可靠性就是一个常见的问题。如果在项目中遇到需要保证消息一定被消费的场景时，如何保证消息不丢失，如何保证消息的可靠性？

## 如何保证RabbitMQ的消息可靠性

### 消息丢失的场景
首先放一张RabbitMQ传递消息的流程图：
![image.png](http://minio.api.crjblog.top/image-host/img/2024/03/22/2024-03-22T22:17:13-a2164f29.png)
**生产者Publisher** 将消息发送到指定的 **交换机Exchange**，交换机根据路由规则路由到绑定的 **队列Queue** 中，最后和消费者建立连接后，将消息推送给 **消费者Consumer**。
消息从生产者到消费者的每一步都可能导致消息丢失：
- 发送消息时丢失：
	- 生产者发送消息时连接MQ失败
	- 生产者发送消息时到达MQ后未找到Exchange
	- 生产者发送消息到达MQ的Exchange后，未找到合适的Queue
	- 生产者发送消息到达MQ后，处理消息的进程发生异常
- MQ导致消息丢失：
	- 消息到达MQ，保存到队列后，尚未消费就突然宕机
- 消费者处理消息时丢失：
	- 消息接收后尚未处理突然宕机
	- 消息接收后处理过程中抛出异常

综上，要解决消息丢失问题，保证MQ的可靠性，就必须从3个方面入手：
- 确保生产者一定把消息发送到MQ
- 确保MQ不会将消息弄丢
- 确保消费者一定要处理消息

